<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="ITI Attendance System" />

    <!-- Search Engine -->
    <meta name="description" content="description about ITI Attendance System" />
    <meta name="image" content="images/logo.png" />
    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="page title" />
    <meta name="twitter:description" content="description about ITI Attendance System" />
    <!-- Open Graph general (Facebook, Pinterest & Google+) -->
    <meta name="og:title" content="page title" />
    <meta name="og:description" content="description about ITI Attendance System" />
    <meta name="og:type" content="website" />

    <!-- frameworks CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />

    <!-- font awesome css -->
    <link rel="stylesheet" href="css/line-awesome.min.css">
    <!-- custom style -->
    <link rel="stylesheet" href="css/style.css" />

    <title>ITI Attendance System</title>
    <link rel="shortcut icon" href="images/fav.svg" type="image/x-icon" />

    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/popper.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- loading window -->
    <!-- <div class="load">
        <div class="circle">
            <div class="circle__spin">
                <svg>
                    <circle cx="50%" cy="50%" r="67px"></circle>
                </svg>
            </div>
        </div>
    </div> -->

    <div class="page login-bg">
        <div class="page-single">
            <div class="container">
                <div class="row">
                    <div class="col mx-auto">
                        <div class="row justify-content-center">
                            <div class="col-sm-10 col-md-8 col-lg-5">
                                <div class="card">
                                    <div class="p-4 pt-6 text-center">
                                        <h1 class="mb-2">Login</h1>
                                        <p class="text-muted">Sign In to your account</p>
                                    </div>
                                    <form class="card-body pt-0 needs-validation" id="loginForm" name="loginForm"
                                        novalidate>
                                        <div class="form-group">
                                            <label class="form-label">Username</label>
                                            <input class="form-control" id="username" name="username"
                                                placeholder="Enter your username" type="text" required>
                                            <div class="invalid-feedback">Please enter your username</div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Password</label>
                                            <input class="form-control" id="password" name="password"
                                                placeholder="password" type="password" required autocomplete>
                                            <div class="invalid-feedback">Please enter your password</div>
                                        </div>
                                        <div class="form-group">
                                            <label class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input"
                                                    name="example-checkbox1" value="option1">
                                                <span class="custom-control-label">Remember me</span>
                                            </label>
                                        </div>
                                        <div class="button-block">
                                            <button type="submit" id="login_btn"
                                                class="btn btn-primary btn-block">Login</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>


    <script>

        //CHECK VALIDATION FUNCTION
        function validate(e) {
            if ($("input").val() == "") {
                var forms = document.getElementsByClassName("needs-validation");
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.classList.add("was-validated");
                });
            }
            return (false);
        }

        //Authenticate user function
        function checkAuthentication() {
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;

            async function getData() {
                const response = await fetch(`http://localhost:3000/employees?username=${username}`);
                const data = await response.json();
                if (!data.length) {
                    alert('wrong username')
                    return
                } else if (data[0].password != password) {
                    alert("Please enter valid password.");
                    var forms = document.getElementsByClassName("needs-validation");
                    var validation = Array.prototype.filter.call(forms, function (form) {
                        form.classList.add("was-validated");
                    });

                    document.getElementById('password').value = "";
                    return
                } else {
                    console.log('Flag value is ==> ', data[0].flag);
                    alert('Login SUCCESS')

                    if (data[0].flag == 1) {
                        alert('go to admin profile')
                        window.location.href = "./profile-admin.html";
                    } else if (data[0].flag == 0) {
                        alert('go to employee profile')
                        window.location.href = "./profile-employee.html";
                    }
                    else if (data[0].flag == 2) {
                        alert('go to student profile')
                        window.location.href = "./profile-student.html";
                    }
                }
            } getData()

        };


        //and check user authentication
        $('#login_btn').click(function (e) {
            e.preventDefault();
            validate()
            checkAuthentication()
        });
    </script>

</body>

</html>